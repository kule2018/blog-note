<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <title>微信二次分享</title>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <style type="text/css">
        img{width: '100%%'}
    </style>
</head>
<body>
<script>
function ajaxFn() {
    var xhr = new XMLHttpRequest()
    console.log(location.href)
    var tempUrl = location.href.indexOf("?")>-1 ? location.href.split('?')[0]: location.href;
    xhr.open('get', '这是请求配置项的接口?url=' + encodeURIComponent(location.href), true)
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
            wxConfig(JSON.parse(xhr.responseText))
        }
    };
    xhr.send();
}
function wxConfig(res) {
    var datas = res.data
    wx.config({
        debug: false,
        appId: "%s", 
        timestamp: datas.timestamp,
        nonceStr: datas.nonceStr,
        signature: datas.signature,
        jsApiList: [
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ'
        ] 
    });
    wx.ready(function () {
        //分享到朋友圈
        wx.checkJsApi({
                   jsApiList: [
                       'onMenuShareAppMessage'
                   ],
                   success: function (res) {
                   }
               });
        //标题
        var tempUrl = location.href;
        var imgUrl = "http://c.klicen.com/media/share_logo.png";//80*80
        wx.onMenuShareAppMessage({
            title: "%s",
            desc: "",
            imgUrl: imgUrl,
            link: tempUrl,
            type: 'link', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            trigger: function (res) {
            },
            success: function (res) {
            },
            cancel: function (res) {
            },
            fail: function(res){
            }
        });
        wx.onMenuShareTimeline({
            title: "%s",
            imgUrl: imgUrl,
            trigger: function (res) {
            },
            success: function () {
            },
            cancel: function () {
            }
        });
        //分享到朋友
        //分享到qq
        wx.onMenuShareQQ({
            title: "%s",
            desc: "",
            imgUrl: imgUrl,
            trigger: function (res) {
            },
            success: function () {
            },
            cancel: function () {
            }
        });
    });
}
ajaxFn()
</script>
</body>
</html>