<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <title>微信二次分享</title>
    <!-- 引入微信JS SDK文件 -->
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
</head>

<body>
    <script>
        function ajaxFn() {
            var xhr = new XMLHttpRequest()

            xhr.open('get', '这是请求配置项的接口?url=' + location.href, true)
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
                    wxConfig(JSON.parse(xhr.responseText))
                }
            }
            xhr.send()
        }

        function wxConfig(res) {
            // 标题
            var link = location.href;
            var imgUrl = "http://c.klicen.com/media/share_logo.png";//80*80

            wx.config({
                // 是否开启调试（会返回一些错误原因）
                debug: false,

                // 公众号的唯一标识
                appId: res.appId,

                // 签名的时间戳
                timestamp: res.timestamp,

                // 签名的随机串
                nonceStr: res.nonceStr,

                // 签名
                signature: res.signature,

                // 需要调用的JS接口
                jsApiList: [
                    'updateAppMessageShareData',
                    'updateTimelineShareData'
                ]
            });

            // config 验证后会执行ready方法
            wx.ready(function () {

            });

            wx.error(function (res) {
                // config信息验证失败
                console.log(res);
            });

            // 分享到朋友和QQ好友
            wx.updateAppMessageShareData({
                // 分享标题
                title: '',

                // 分享描述
                desc: '',

                // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                link: link,

                // 分享图标
                imgUrl: imgUrl,

                success: function () {
                    // 设置成功
                }
            })

            // 分享到朋友圈，QQ空间
            wx.updateTimelineShareData({
                title: '',
                link: link,
                imgUrl: imgUrl,
                success: function () {
                    // 设置成功
                }
            });

        }
        ajaxFn()
    </script>
</body>

</html>